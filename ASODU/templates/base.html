{% load static %}
<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="icon" href="{% static 'img/fav/favicon.ico' %}" type="image">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'img/fav/fapple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/fav/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'img/fav/favicon-16x16.png' %}">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <title>
      {% block title %}
        Title not set
      {% endblock %} 
    </title>
  </head>
  <body style="background-color: #88BDBC">
    {% include 'includes/header.html' %}
    <main>
      <div class="container-fluid py-5 px-4">
        {% if user.is_authenticated %}
        Пользователь: {{ user.get_full_name }}
        {% endif %}
        <h1>
          {% block header %}
          {% endblock %}
        </h1>
        {% block content %}
          Контента нет.
        {% endblock %} 
      </div>
    </main>
    {% include 'includes/footer.html' %}
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script>
      let templateForm = document.getElementById("id_formset_empty_form")
      let equipmentForm = document.querySelectorAll(".eqipment-form")
      let container = document.querySelector("#form-container")
      let addButton = document.querySelector("#add-form")
      let totalForms = document.querySelector("#id_amounts-TOTAL_FORMS")    
      let formNum = equipmentForm.length

      addButton.addEventListener('click', addForm)

      function addForm(e){
          e.preventDefault()
          let newForm = templateForm.content.cloneNode(true)
          let formFields = newForm.querySelectorAll("[id^=id_amounts-__prefix__-]")
          formFields.forEach(field => {
            let formRegex = RegExp("amounts-__prefix__", 'g')
            field.id = field.id.replace(formRegex, `amounts-${formNum}`)
            field.name = field.name.replace(formRegex, `amounts-${formNum}`)
          })
          formNum++
          container.insertBefore(newForm, addButton)
          totalForms.setAttribute('value', `${formNum+1}`)
      }
    </script>
  </body>
</html>
